@model IEnumerable<OrderViewModel>

@{
    ViewData["Title"] = "My Orders";
    Layout = "~/Views/Shared/_MainThemeLayout.cshtml";
    ViewBag.CurrentPage = "orders";
}

@section Styles {
    <style>
        :root {
            --pharma-red: #8B0000;
        }

        .section-title {
            font-weight: 700;
            color: #212529;
            letter-spacing: -0.5px;
        }

        /* === Modern Order Card === */
        .order-card {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            position: relative;
        }

            .order-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 20px rgba(139, 0, 0, 0.08);
                border-color: rgba(139, 0, 0, 0.2);
            }

        /* Card Header */
        .order-header {
            background-color: #fcfcfc;
            border-bottom: 1px solid #f1f3f5;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .order-id {
            font-size: 1.1rem;
            font-weight: 800;
            color: #212529;
            letter-spacing: 0.5px;
        }

        .order-date {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }

        /* Card Body */
        .order-body {
            padding: 1.5rem;
        }

        .info-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #868e96;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
            display: block;
        }

        .price-text {
            color: var(--pharma-red);
            font-weight: 800;
            font-size: 1.35rem;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.5em 1em;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }

        .status-processing {
            background-color: #e2e3e5;
            color: #383d41;
        }

        .status-shipped {
            background-color: #cce5ff;
            color: #004085;
        }

        .status-delivered {
            background-color: #d1e7dd;
            color: #0f5132;
        }

        .status-cancelled, .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background-color: #cff4fc;
            color: #055160;
        }

        /* Action Button (View Details) */
        .btn-view-details {
            background-color: transparent;
            color: var(--pharma-red);
            border: 2px solid var(--pharma-red);
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            font-weight: 700;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }

            .btn-view-details:hover {
                background-color: var(--pharma-red);
                color: #fff !important;
                text-decoration: none;
                box-shadow: 0 4px 10px rgba(139, 0, 0, 0.2);
            }

        /* === Continue Shopping Button (Fixed Hover) === */
        .btn-pharma-outline {
            background-color: #fff;
            color: var(--pharma-red); /* النص أحمر */
            border: 2px solid var(--pharma-red); /* البوردر أحمر */
            padding: 0.7rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }

            .btn-pharma-outline:hover {
                background-color: var(--pharma-red); /* الخلفية تقلب أحمر */
                color: #ffffff !important; /* النص يقلب أبيض */
                border-color: var(--pharma-red);
                box-shadow: 0 4px 10px rgba(139, 0, 0, 0.2);
            }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 5rem 1rem;
        }

        .empty-icon {
            font-size: 5rem;
            color: #e9ecef;
            margin-bottom: 1.5rem;
        }

        .btn-start-shopping {
            background-color: var(--pharma-red);
            color: #fff!important;
            border-radius: 50px;
            padding: 0.8rem 2.5rem;
            font-weight: 700;
            transition: 0.3s;
        }

            .btn-start-shopping:hover {
                background-color: #fff!important;
                color: var(--pharma-red)!important;
                text-decoration: none;
                border-color: var(--pharma-red);
            }
    </style>
}

@section Breadcrumb {
    <div class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-0">
                    <a asp-controller="Home" asp-action="Index" class="text-decoration-none text-muted">Home</a>
                    <span class="mx-2 mb-0">/</span>
                    <a asp-controller="Account" asp-action="Profile" class="text-decoration-none text-muted">Profile</a>
                    <span class="mx-2 mb-0">/</span>
                    <strong class="text-black">My Orders</strong>
                </div>
            </div>
        </div>
    </div>
}

<div class="site-section pt-5 pb-5" style="background-color: #f9f9f9;">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-12">
                <h2 class="h3 section-title text-uppercase mb-3">Order History</h2>
                <p class="text-muted">Track your past purchases and current order status.</p>
            </div>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    @foreach (var order in Model)
                    {
                        var statusClass = "badge-info";
                        var statusText = order.Status ?? "Processing";
                        var s = statusText.ToLower();
                        if (statusText == "MoreInfoRequired")
                        {
                            statusText = "More Info Required";
                        }
                        else if (statusText == "PaymentReceived")
                        {
                            statusText = "Payment Received";
                        }

                        if (s.Contains("pending")) { statusClass = "status-pending"; }
                        else if (s.Contains("approved")) { statusClass = "status-approved"; }
                        else if (s.Contains("PaymentReceived")) { statusClass = "status-shipped"; }
                        else if (s.Contains("delivered")) { statusClass = "status-delivered"; }
                        else if ( s.Contains("reject")) { statusClass = "status-cancelled"; }
                        else if (s.Contains("cancel")) { statusClass = "status-processing"; }

                        <div class="order-card">
                            <div class="order-header">
                                <div>
                                    <span class="icon-receipt mr-2 text-muted"></span>
                                    <span class="order-id">Order #@order.Id</span>
                                </div>
                                <div class="text-right">
                                    <span class="order-date">
                                        <i class="icon-calendar mr-1"></i> @order.OrderDate.ToString("MMM dd, yyyy")
                                    </span>
                                </div>
                            </div>

                            <div class="order-body">
                                <div class="row align-items-center">
                                    <div class="col-6 col-md-4 mb-3 mb-md-0">
                                        <span class="info-label">Status</span>
                                        <span class="status-badge @statusClass">@statusText</span>
                                    </div>

                                    <div class="col-6 col-md-4 mb-3 mb-md-0">
                                        <span class="info-label">Total Amount</span>
                                        <span class="price-text">$@order.TotalAmount.ToString("F2")</span>
                                    </div>

                                    <div class="col-12 col-md-4 text-md-right mt-2 mt-md-0">
                                        <a asp-action="Details" asp-route-id="@order.Id" class="btn-view-details">
                                            View Details 
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="row mt-5">
                <div class="col-12 text-center">
                    <a asp-controller="Home" asp-action="Store" class="btn btn-pharma-outline">
                        <i class="icon-arrow-left mr-2"></i> Continue Shopping
                    </a>
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-12">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <span class="icon-shopping-bag"></span>
                        </div>
                        <h3 class="text-black font-weight-bold mb-3">No Orders Found</h3>
                        <p class="text-muted mb-4">You haven't placed any orders yet. Start exploring our products!</p>
                        <a asp-controller="Home" asp-action="Store" class="btn btn-start-shopping">
                            Start Shopping Now
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>